<html>
<head>
	<title>ST-JS: Borrowing Java's syntax to write type-safe JavaScript</title>
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu Mono:regular,bold&subset=Latin">
	<link rel="stylesheet" type="text/css" href="reset.css">
	<link rel="stylesheet" type="text/css" href="index.css">
	<link rel="stylesheet" type="text/css" href="960.css" />
	
	<link href="prettify-theme.css" rel="stylesheet" type="text/css" >
	<script src="google-code-prettify/prettify.js" type="text/javascript"></script>


</head>
<body onload="prettyPrint()">

<div class="topHighlight">
	<div class="container_12">
		<div class="grid_9">
			<h1><a href="index.html">ST-JS : Strongly Typed JavaScript</a></h1>
			<h2>Borrowing Java's syntax to write type-safe JavaScript</h2>
		</div>
	</div>
</div>
		


<div class="container_12 content">
	
	<div class="grid_2 leftColumn">
		<ul class="menu">
			<li>
				<a href="gettingStarted.html">Getting Started</a>
				<ul class="submenu">
					<li><a href="gettingStarted.html#why">Why ST-JS?</a></li>
					<li><a href="gettingStarted.html#how">How does it work?</a></li>
					<li><a href="gettingStarted.html#what">What does it look like?</a></li>
					<li><a href="gettingStarted.html#limitations">Limitations</a></li>
				</ul>
			</li>
			<li><a href="download.html">Download</a></li>
			<li><a href="tutorial.html">Tutorial</a></li>
			<li>
				<a href="reference.html">Documentation</a>
				<ul class="submenu">
					<li><a href="jslib.html">JavaScript bridge</a></li>
					<li><a href="jslib.html">DOM bridge</a></li>
					<li><a href="bridges.html">Library bridges</a></li>
					<li><a href="maven.html">Maven plugin</a></li>
					<li><a href="eclipse.html">Eclipse integration</a></li>
					<li><a href="junit.html">JUnit runner</a></li>
				</ul>
			</li>
			<li><a href="team.html">Team</a></li>
			<li><a href="http://axcraciun.wordpress.com/">Blog</a></li>
		</ul>
	</div>
	
	<div class="grid_10">
		<h3><a id="why">Why ST-JS?</a></h3>
		<p>
		Dynamically typed languages are good for small to medium projects.
		But when the size of the project grows and handled data becomes complex
		a strongly typed language gives you an extra guarantee that your
		changes won&#8217;t break your code.
		</p>
		<p>
		The current trend is to build very rich web interfaces.
		The problem is that the only option all the browsers offer is JavaScript, that is dynamically typed language.
		Even if the support from IDEs and browsers keeps growing, you'll find out pretty soon that a JavaScript line of code
		gets quite expensive in a big (2000+ JavaScript LOC) project.
		</p>
		<p>If you landed to our project&#8217;s page, it&#8217;s almost sure you already
		have experience with GWT or at least you heard about it.
		Even though as a Java developer we are naturally attracted by their
		philosophy, it bothered us that their solution is too intrusive:
		it imposes you a new framework, new tools, when we were only looking
		for something that can add a strongly typed dimension to our JavaScript
		code.
		</p>
	</div>
	
		
		
		
		
	<div class="grid_10">
		<h3><a id="how">How does it work?</a></h3>
		<p>STJS does not try to hide from you how JavaScript works.
		STJS addresses Java developers that are comfortable with a regular
		JavaScript way of building application usually using a component
		library (jQuery or others).
		We don&#8217;t believe in generated JavaScript that is unreadable and
		impossible to debug.
		</p>
		<p>
		So we limited STJS to only generate JavaScript from a Java code that is as close as possible to the original code.
		We&#8217;d like to believe that the generated JavaScript code is as we&#8217;d of write it ourselves.
		</p>
		<p>The only dependency STJS requires at runtime is a small JavaScript library
		(that basically provides the function to simulate inheritance in
		JavaScript). That&#8217;s it!
		STJS imposes no java dependency, no visual component, no AJAX framework.
		You can feel free to use the JavaScript libraries and components you
		like.
		We&#8217;d like to believe that if one day you&#8217;ll stop using STJS (!?), you
		just take the generated JavaScript code and continue building your
		project.</p>

		<p>
		The Java code you write (with the purpose to generate
		JavaScript) will not be executed as such. You can only use in this code
		the Java classes that have their JavaScript counterpart when you
		launch it in your browser. So you CANNOT use typical Java classes like
		Java util or other JDK packages.

		Please note that you need at least <b>Java 6</b> to have ST-JS compiling your projects.
		</p>
		<p>
		If we managed to convince you, please continue further for a few
		minutes tutorial.
		</p>
	</div>
		
	
	
	
	
	
	
	
	<div class="push_2 grid_10">
		<h3><a id="what">What does it look like?</a></h3>
		<p>Here is an example of a code written in Java and the corresponding generated
		JavaScript.
		The Java code may seem a bit longer and possibly more complicated at a
		first glance, but it provides you with all the advantages of a typed
		language, while preserving as much as possible the resemblance to the
		javascript style of programming. The visual resemblance is crucial
		here since it allows for faster learning and easier transition. This
		visual resemblance maintained throughout the library design
		</p>
		
		<h4>Short example</h4>
	</div>

	<div class="prefix_2 grid_5">
<pre class="code prettyprint lang-java">
// Java

$("#form").submit(new EventHandler() {
  public void onEvent(Event ev, HTMLElement THIS) {
    StockData stockData =
      that.updateStock($("#newStock").val());
    $(that.row(stockData)).appendTo("table tbody");
    that.stocks.push(stockData.stock);
  }
});</pre>
	</div>
		
	<div class="grid_5">
<pre class="code prettyprint lang-javascript">
// Generated JavaScript

$("#form").submit(function(ev) {

  var stockData =
    that.updateStock($("#newStock").val());
  $(that.row(stockData)).appendTo("table tbody");
  that.stocks.push(stockData.stock);

});
</pre>
	</div>
		
		
	<div class="prefix_2 grid_10">
		<h4>Some more javascript constructs</h4>
		<p>
		The problem with having JavaScript code generated from Java is that
		Java is less rich than JavaScript. There are JavaScript constructions
		that do not have
		their corresponding in Java (or they are different) like object (map)
		constructors, array constructors, inline functions.
		We tried to provide constructions that may look unusual for a Java
		developer but somehow familiar to a JavaScript developer.
		</p>

		<h5>Data Objects</h5>
		<p>Javascript has a very handy syntax for creating objects with all of their 
		properties already initialized. As you probably know, this syntax is the basis 
		of the JSON format.</p>
		<p>ST-JS promotes the usage of a similar syntax in Java, but using proper type declarations.</p>
	</div>
	<div class="prefix_2 grid_5">
<pre class="code prettyprint lang-java">
// Java

StockData stock = new StockData() {{
    last = 10.0;
    close = 2.0;
    stock = "ABC";
}};</pre>
	</div>

	<div class="grid_5">
<pre class="code prettyprint lang-javascript">
// Generated JavaScript

var stock = {
	"last" : 10,
	"close" : 2,
	"stock" : "ABC"
};
</pre>
	</div>
	<div class="clear"></div>
		
	<div class="prefix_2 grid_10">
		<h5>Hashes / Associative arrays / Maps</h5>
		<p>In JavaScript, every object can also be used as an associative array 
		with string keys. This allows each field of an object to be accessed directly
		via its name.<p>
		<p>ST-JS provides a bridge class that allows you to use this behavior in your
		Java code, and see it the proper associative array construct being used in the
		translated javascript. This capability is provided via the 
		<strong>org.stjs.javascript.Map</strong> class</p>
	</div>
	
	<div class="prefix_2 grid_5">
<pre class="code prettyprint lang-java">
// Java

// This Map is a org.stjs.javascript.Map
Map&lt;String, Object&gt; stock = $map(
    "last", 2.0,
    "close", 3.5,
    "symbol", "ABC"
);

Double close = map.$get("close");
stock.$set("close", 4.8);
stock.$delete("close");</pre>
	</div>
	
	<div class="grid_5">
<pre class="code prettyprint lang-javascript">
// Generated JavaScript


var stock = {
    "last" : 2.0,
    "close" : 3.5,
    "symbol" : "ABC";
};

var close = stock["close"];
stock["close"] = 4.8;
delete stock["close"];</pre>
	</div>
	<div class="clear"></div>
		
	<div class="prefix_2 grid_10">
		<h5>Arrays</h5>
		<p>JavaScript arrays behave like a mixture of a Java's lists and arrays. ST-JS
		provides the <strong>org.stjs.javascript.Array</strong> class to bring the
		JavaScript behavior in Java. This class offers the same methods as its 
		JavaScript counterpart. Givent that the bracket ([]) construct can only be 
		used in Java with a regular array, this class provides $get/$set methods
		that will generate the expected code in JavaScript</p>
	</div>
	
	<div class="prefix_2 grid_5">
<pre class="code prettyprint lang-java">
// Java

Array&lt;Integer&gt; array = $array(1, 5, 10);
Integer value = array.$get(2);
array.$set(2, 4);

// looping by counter
for(int i = 0; i &lt; array.$length(); i ++){
    console.info(i + " : " + array.$get(i));
}

// looping with for-in
for(String i : array){



    console.info(i + " : " + array.$get(i));
}</pre>
		</div>
		
	<div class="grid_5">
<pre class="code prettyprint lang-javascript">
// Generated Javascript

var array = [1, 5, 10];
var value = array[2];
array[2] = 4;

// looping by counter
for(var i = 0; i &lt; array.length; i ++){
    console.info(i + " : " + array[i]);
}

// looping with for-in
for(var i : array){
    if(array.hasOwnProperty(i)){
        continue;
    }
    console.info(i + " : " + array[i]);
}
</pre>
	</div>
	<div class="clear"></div>
		
	<div class="prefix_2 grid_10">
		<h5>Inheritance</h5>
		<p>Class inheritance is a fundamental concept in Class-based, Object-Oriented
		languages like Java. That concept doesn't exist in JavaScript, but 
		its behavior can be reproduced in its native prototype-based inheritance.</p>
		<p>In order to keep the generated JavaScript code as close as possible to the
		source Java code, we have decided not to enforce the (in-)visibility of members
		in JavaScript. This means that when a field is marked privat, protected or
		package-protected in the Java source, it will be generated as if it was public
		in the generated JavaScript. This is an acceptable compromise given that the
		visibility restrictions are enforced by the Java compiler before the JavaScript
		code is generated.</p>
	</div>
	
	<div class="prefix_2 grid_5">
<pre class="code prettyprint lang-java">
// Java

public class Child extends Parent {
    public Child(String name) {
        super(name);
        this.name = name;
    }


    
    public static int staticField = 1;
    public int instanceField = 2;
    public String name = "default";

    @Override
    public void instanceMethod(String n) {
        super.instanceMethod(n + "-");
    }

    public static void staticMethod() {
        staticField += 1;
    }
}</pre>
	</div>
	<div class="grid_5">
<pre class="code prettyprint lang-javascript">
// Generated JavaScript


Child = function(name) {
   this._super(null, test);
   this.name = name;
}

stjs.extend(Child, Parent, [], 
        function(constructor, prototype){
    constructor.staticField = 1;
    prototype.instanceField = 2;
    prototype.name = "default";
    

    prototype.instanceMethod = function(n) { 
        this._super("instanceMethod", n + "-");
    }

    constructor.staticMethod = function() {
        Child.staticField += 1;
    }
});</pre>
	</div>
	<div class="clear"></div>

	<div class="prefix_2 grid_10">
		<h5>Comparison</h5>
		<p>The comparison of objects or primitives is slightly different between Java and Javscript. For example <i>equals</i> method does not exist in JavaScript (and there is no
		way to influence how egality operators behave in JavaScript).<br/>
		Conversely the triple "=" (===) does not exist in Java. And the "==" sign has a slightly different meaning: in JavaScript it may be accompanied by a type conversion!<br/>
		To have a predictable behavior of the generated JavaScript, the <i>equals</i> method is generated as-is. The equals method was added to all primitive types wrappers 
		in JavaScript. More
		all generated classes will have an equals method defined in their hierarchy.
		The "==" sign is left untouched as there is basically no automatic type conversion involved (because the initial Java code wouldn't allow it).
		</p>
		
	</div>

	<div class="prefix_2 grid_10">
		<h3>Limitations, aka: "What you cannot do in ST-JS?"</h3>
		<p>Due to the fact that ST-JS strives to keep the generated JavaScript code as close as possible to your source Java code, it has to deal with the limitations of both Java
		and JavaScript. This means that some of the features of the Java language cannot be used in your ST-JS code, and will cause an error during the Java->JavaScript transpilation.
		</p>
		
		<p>Here are the main restrictions imposed by ST-JS</p>
		
		<p><strong>No overloading.</strong> This means you cannot have multiple methods with the same name (or multiple constructors) in the same class. Method 
		overriding however is allowed, so you can easily change the behavior of a method in a subclass.</p>
		<p><strong>No separate namespace for fields and methods.</strong> As a result, you cannot have a method and a field with the same name within one class and all 
		of its parent classes and interfaces!</p>
		<p><strong>Javascript keywords cannot be used as identifiers.</strong> So you cannot use JavaScript keywords or reserved words (such as "function", "prototype",
		"var", etc...) as field, method or class name.</p>
		<p><strong>Limited support for varargs.</strong>. Varags are only allowed if your method has a single argument, and this argument's name is "arguments".</p>
		<p><strong>Instance fields can only be initialized at declaration with litterals.</strong> Therefore any instance field that is not a primitive type, a Number, a String or null must be initialized in the constructor.</p>
		<p><strong>No native Java arrays.</strong>. Native Java arrays (such as String[]) cannot be used as they are not direclty compatible with the JavaScript version of arrays. 
		JavaScript arrays are much richer than Java arrays, and provide a set of useful methods such as push, slice, etc...
		On top of that, the for-in iteration in Java array is done on values (<i>for(String s : array)</i>) while the iteration in JavaScript is done on indexes (<i>for(var idx : array)</i>). ST-JS provides the <strong>org.stjs.javascript.Array</strong> class to reproduced the JavaScript array behavior.</p>
		
		<p>While some of these limitations could be worked around by making STJS a little bit more complex, it would result in the JavaScript code diverging too far from the
		original Java source. Removing these limitations would need going against to the philosophy of ST-JS: the generated JavaScript code is immediately recognizable when 
		compared with your Java source code. That's why we prefer to produce transpilation-time errors and to ask the user to find a suitable alternative.</p>
		</p>
	</div>

</div>

<a href="https://github.com/st-js/st-js/"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
</body>
</html>
 
 
